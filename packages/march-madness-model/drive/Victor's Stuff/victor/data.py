from utils import mkdir_p
import pandas

datapath = '../../data/'
processeddata = '../../data/processed/'

Teams = pandas.read_csv(datapath + 'Teams.csv')
TeamsDict = Teams.to_dict()
TeamObjects = {TeamsDict['Team_Id'][k] : {'Team_Name' : TeamsDict['Team_Name'][k]} for k in TeamsDict['Team_Id']}
# print(TeamObjects)
# {1101: {'Team_Name': 'Abilene Chr'}, 1102: {'Team_Name': 'Air Force'}, 1103: {'Team_Name': 'Akron'}, 1104: {'Team_Name': 'Alabama'}, 1105: {'Team_Name': 'Alabama A&M'}, 1106: {'Team_Name': 'Alabama St'}, 1107: {'Team_Name': 'Albany NY'}, 1108: {'Team_Name': 'Alcorn St'}, 1109: {'Team_Name': 'Alliant Intl'}, 1110: {'Team_Name': 'American Univ'}, 1111: {'Team_Name': 'Appalachian St'}, 1112: {'Team_Name': 'Arizona'}, 1113: {'Team_Name': 'Arizona St'}, 1114: {'Team_Name': 'Ark Little Rock'}, 1115: {'Team_Name': 'Ark Pine Bluff'}, 1116: {'Team_Name': 'Arkansas'}, 1117: {'Team_Name': 'Arkansas St'}, 1118: {'Team_Name': 'Armstrong St'}, 1119: {'Team_Name': 'Army'}, 1120: {'Team_Name': 'Auburn'}, 1121: {'Team_Name': 'Augusta'}, 1122: {'Team_Name': 'Austin Peay'}, 1123: {'Team_Name': 'Ball St'}, 1124: {'Team_Name': 'Baylor'}, 1125: {'Team_Name': 'Belmont'}, 1126: {'Team_Name': 'Bethune-Cookman'}, 1127: {'Team_Name': 'Binghamton'}, 1128: {'Team_Name': 'Birmingham So'}, 1129: {'Team_Name': 'Boise St'}, 1130: {'Team_Name': 'Boston College'}, 1131: {'Team_Name': 'Boston Univ'}, 1132: {'Team_Name': 'Bowling Green'}, 1133: {'Team_Name': 'Bradley'}, 1134: {'Team_Name': 'Brooklyn'}, 1135: {'Team_Name': 'Brown'}, 1136: {'Team_Name': 'Bryant'}, 1137: {'Team_Name': 'Bucknell'}, 1138: {'Team_Name': 'Buffalo'}, 1139: {'Team_Name': 'Butler'}, 1140: {'Team_Name': 'BYU'}, 1141: {'Team_Name': 'C Michigan'}, 1142: {'Team_Name': 'Cal Poly SLO'}, 1143: {'Team_Name': 'California'}, 1144: {'Team_Name': 'Campbell'}, 1145: {'Team_Name': 'Canisius'}, 1146: {'Team_Name': 'Cent Arkansas'}, 1147: {'Team_Name': 'Centenary'}, 1148: {'Team_Name': 'Central Conn'}, 1149: {'Team_Name': 'Charleston So'}, 1150: {'Team_Name': 'Charlotte'}, 1151: {'Team_Name': 'Chattanooga'}, 1152: {'Team_Name': 'Chicago St'}, 1153: {'Team_Name': 'Cincinnati'}, 1154: {'Team_Name': 'Citadel'}, 1155: {'Team_Name': 'Clemson'}, 1156: {'Team_Name': 'Cleveland St'}, 1157: {'Team_Name': 'Coastal Car'}, 1158: {'Team_Name': 'Col Charleston'}, 1159: {'Team_Name': 'Colgate'}, 1160: {'Team_Name': 'Colorado'}, 1161: {'Team_Name': 'Colorado St'}, 1162: {'Team_Name': 'Columbia'}, 1163: {'Team_Name': 'Connecticut'}, 1164: {'Team_Name': 'Coppin St'}, 1165: {'Team_Name': 'Cornell'}, 1166: {'Team_Name': 'Creighton'}, 1167: {'Team_Name': 'CS Bakersfield'}, 1168: {'Team_Name': 'CS Fullerton'}, 1169: {'Team_Name': 'CS Northridge'}, 1170: {'Team_Name': 'CS Sacramento'}, 1171: {'Team_Name': 'Dartmouth'}, 1172: {'Team_Name': 'Davidson'}, 1173: {'Team_Name': 'Dayton'}, 1174: {'Team_Name': 'Delaware'}, 1175: {'Team_Name': 'Delaware St'}, 1176: {'Team_Name': 'Denver'}, 1177: {'Team_Name': 'DePaul'}, 1178: {'Team_Name': 'Detroit'}, 1179: {'Team_Name': 'Drake'}, 1180: {'Team_Name': 'Drexel'}, 1181: {'Team_Name': 'Duke'}, 1182: {'Team_Name': 'Duquesne'}, 1183: {'Team_Name': 'E Illinois'}, 1184: {'Team_Name': 'E Kentucky'}, 1185: {'Team_Name': 'E Michigan'}, 1186: {'Team_Name': 'E Washington'}, 1187: {'Team_Name': 'East Carolina'}, 1188: {'Team_Name': 'Edwardsville'}, 1189: {'Team_Name': 'Elon'}, 1190: {'Team_Name': 'ETSU'}, 1191: {'Team_Name': 'Evansville'}, 1192: {'Team_Name': 'F Dickinson'}, 1193: {'Team_Name': 'Fairfield'}, 1194: {'Team_Name': 'FL Atlantic'}, 1195: {'Team_Name': 'FL Gulf Coast'}, 1196: {'Team_Name': 'Florida'}, 1197: {'Team_Name': 'Florida A&M'}, 1198: {'Team_Name': 'Florida Intl'}, 1199: {'Team_Name': 'Florida St'}, 1200: {'Team_Name': 'Fordham'}, 1201: {'Team_Name': 'Fresno St'}, 1202: {'Team_Name': 'Furman'}, 1203: {'Team_Name': 'G Washington'}, 1204: {'Team_Name': 'Ga Southern'}, 1205: {'Team_Name': 'Gardner Webb'}, 1206: {'Team_Name': 'George Mason'}, 1207: {'Team_Name': 'Georgetown'}, 1208: {'Team_Name': 'Georgia'}, 1209: {'Team_Name': 'Georgia St'}, 1210: {'Team_Name': 'Georgia Tech'}, 1211: {'Team_Name': 'Gonzaga'}, 1212: {'Team_Name': 'Grambling'}, 1213: {'Team_Name': 'Grand Canyon'}, 1214: {'Team_Name': 'Hampton'}, 1215: {'Team_Name': 'Hardin-Simmons'}, 1216: {'Team_Name': 'Hartford'}, 1217: {'Team_Name': 'Harvard'}, 1218: {'Team_Name': 'Hawaii'}, 1219: {'Team_Name': 'High Point'}, 1220: {'Team_Name': 'Hofstra'}, 1221: {'Team_Name': 'Holy Cross'}, 1222: {'Team_Name': 'Houston'}, 1223: {'Team_Name': 'Houston Bap'}, 1224: {'Team_Name': 'Howard'}, 1225: {'Team_Name': 'Idaho'}, 1226: {'Team_Name': 'Idaho St'}, 1227: {'Team_Name': 'IL Chicago'}, 1228: {'Team_Name': 'Illinois'}, 1229: {'Team_Name': 'Illinois St'}, 1230: {'Team_Name': 'Incarnate Word'}, 1231: {'Team_Name': 'Indiana'}, 1232: {'Team_Name': 'Indiana St'}, 1233: {'Team_Name': 'Iona'}, 1234: {'Team_Name': 'Iowa'}, 1235: {'Team_Name': 'Iowa St'}, 1236: {'Team_Name': 'IPFW'}, 1237: {'Team_Name': 'IUPUI'}, 1238: {'Team_Name': 'Jackson St'}, 1239: {'Team_Name': 'Jacksonville'}, 1240: {'Team_Name': 'Jacksonville St'}, 1241: {'Team_Name': 'James Madison'}, 1242: {'Team_Name': 'Kansas'}, 1243: {'Team_Name': 'Kansas St'}, 1244: {'Team_Name': 'Kennesaw'}, 1245: {'Team_Name': 'Kent'}, 1246: {'Team_Name': 'Kentucky'}, 1247: {'Team_Name': 'La Salle'}, 1248: {'Team_Name': 'Lafayette'}, 1249: {'Team_Name': 'Lamar'}, 1250: {'Team_Name': 'Lehigh'}, 1251: {'Team_Name': 'Liberty'}, 1252: {'Team_Name': 'Lipscomb'}, 1253: {'Team_Name': 'Long Beach St'}, 1254: {'Team_Name': 'Long Island'}, 1255: {'Team_Name': 'Longwood'}, 1256: {'Team_Name': 'Louisiana Tech'}, 1257: {'Team_Name': 'Louisville'}, 1258: {'Team_Name': 'Loy Marymount'}, 1259: {'Team_Name': 'Loyola MD'}, 1260: {'Team_Name': 'Loyola-Chicago'}, 1261: {'Team_Name': 'LSU'}, 1262: {'Team_Name': 'MA Lowell'}, 1263: {'Team_Name': 'Maine'}, 1264: {'Team_Name': 'Manhattan'}, 1265: {'Team_Name': 'Marist'}, 1266: {'Team_Name': 'Marquette'}, 1267: {'Team_Name': 'Marshall'}, 1268: {'Team_Name': 'Maryland'}, 1269: {'Team_Name': 'Massachusetts'}, 1270: {'Team_Name': 'McNeese St'}, 1271: {'Team_Name': 'MD E Shore'}, 1272: {'Team_Name': 'Memphis'}, 1273: {'Team_Name': 'Mercer'}, 1274: {'Team_Name': 'Miami FL'}, 1275: {'Team_Name': 'Miami OH'}, 1276: {'Team_Name': 'Michigan'}, 1277: {'Team_Name': 'Michigan St'}, 1278: {'Team_Name': 'Minnesota'}, 1279: {'Team_Name': 'Mississippi'}, 1280: {'Team_Name': 'Mississippi St'}, 1281: {'Team_Name': 'Missouri'}, 1282: {'Team_Name': 'Missouri KC'}, 1283: {'Team_Name': 'Missouri St'}, 1284: {'Team_Name': 'Monmouth NJ'}, 1285: {'Team_Name': 'Montana'}, 1286: {'Team_Name': 'Montana St'}, 1287: {'Team_Name': 'Morehead St'}, 1288: {'Team_Name': 'Morgan St'}, 1289: {'Team_Name': 'Morris Brown'}, 1290: {'Team_Name': 'MS Valley St'}, 1291: {'Team_Name': "Mt St Mary's"}, 1292: {'Team_Name': 'MTSU'}, 1293: {'Team_Name': 'Murray St'}, 1294: {'Team_Name': 'N Colorado'}, 1295: {'Team_Name': 'N Dakota St'}, 1296: {'Team_Name': 'N Illinois'}, 1297: {'Team_Name': 'N Kentucky'}, 1298: {'Team_Name': 'Navy'}, 1299: {'Team_Name': 'NC A&T'}, 1300: {'Team_Name': 'NC Central'}, 1301: {'Team_Name': 'NC State'}, 1302: {'Team_Name': 'NE Illinois'}, 1303: {'Team_Name': 'NE Omaha'}, 1304: {'Team_Name': 'Nebraska'}, 1305: {'Team_Name': 'Nevada'}, 1306: {'Team_Name': 'New Hampshire'}, 1307: {'Team_Name': 'New Mexico'}, 1308: {'Team_Name': 'New Mexico St'}, 1309: {'Team_Name': 'New Orleans'}, 1310: {'Team_Name': 'Niagara'}, 1311: {'Team_Name': 'Nicholls St'}, 1312: {'Team_Name': 'NJIT'}, 1313: {'Team_Name': 'Norfolk St'}, 1314: {'Team_Name': 'North Carolina'}, 1315: {'Team_Name': 'North Dakota'}, 1316: {'Team_Name': 'North Florida'}, 1317: {'Team_Name': 'North Texas'}, 1318: {'Team_Name': 'Northeastern'}, 1319: {'Team_Name': 'Northern Arizona'}, 1320: {'Team_Name': 'Northern Iowa'}, 1321: {'Team_Name': 'Northwestern'}, 1322: {'Team_Name': 'Northwestern LA'}, 1323: {'Team_Name': 'Notre Dame'}, 1324: {'Team_Name': 'Oakland'}, 1325: {'Team_Name': 'Ohio'}, 1326: {'Team_Name': 'Ohio St'}, 1327: {'Team_Name': 'Okla City'}, 1328: {'Team_Name': 'Oklahoma'}, 1329: {'Team_Name': 'Oklahoma St'}, 1330: {'Team_Name': 'Old Dominion'}, 1331: {'Team_Name': 'Oral Roberts'}, 1332: {'Team_Name': 'Oregon'}, 1333: {'Team_Name': 'Oregon St'}, 1334: {'Team_Name': 'Pacific'}, 1335: {'Team_Name': 'Penn'}, 1336: {'Team_Name': 'Penn St'}, 1337: {'Team_Name': 'Pepperdine'}, 1338: {'Team_Name': 'Pittsburgh'}, 1339: {'Team_Name': 'Portland'}, 1340: {'Team_Name': 'Portland St'}, 1341: {'Team_Name': 'Prairie View'}, 1342: {'Team_Name': 'Presbyterian'}, 1343: {'Team_Name': 'Princeton'}, 1344: {'Team_Name': 'Providence'}, 1345: {'Team_Name': 'Purdue'}, 1346: {'Team_Name': 'Quinnipiac'}, 1347: {'Team_Name': 'Radford'}, 1348: {'Team_Name': 'Rhode Island'}, 1349: {'Team_Name': 'Rice'}, 1350: {'Team_Name': 'Richmond'}, 1351: {'Team_Name': 'Rider'}, 1352: {'Team_Name': 'Robert Morris'}, 1353: {'Team_Name': 'Rutgers'}, 1354: {'Team_Name': 'S Carolina St'}, 1355: {'Team_Name': 'S Dakota St'}, 1356: {'Team_Name': 'S Illinois'}, 1357: {'Team_Name': 'Sacred Heart'}, 1358: {'Team_Name': 'Sam Houston St'}, 1359: {'Team_Name': 'Samford'}, 1360: {'Team_Name': 'San Diego'}, 1361: {'Team_Name': 'San Diego St'}, 1362: {'Team_Name': 'San Francisco'}, 1363: {'Team_Name': 'San Jose St'}, 1364: {'Team_Name': 'Santa Barbara'}, 1365: {'Team_Name': 'Santa Clara'}, 1366: {'Team_Name': 'Savannah St'}, 1367: {'Team_Name': 'SC Upstate'}, 1368: {'Team_Name': 'SE Louisiana'}, 1369: {'Team_Name': 'SE Missouri St'}, 1370: {'Team_Name': 'Seattle'}, 1371: {'Team_Name': 'Seton Hall'}, 1372: {'Team_Name': 'SF Austin'}, 1373: {'Team_Name': 'Siena'}, 1374: {'Team_Name': 'SMU'}, 1375: {'Team_Name': 'South Alabama'}, 1376: {'Team_Name': 'South Carolina'}, 1377: {'Team_Name': 'South Dakota'}, 1378: {'Team_Name': 'South Florida'}, 1379: {'Team_Name': 'Southern Miss'}, 1380: {'Team_Name': 'Southern Univ'}, 1381: {'Team_Name': 'Southern Utah'}, 1382: {'Team_Name': 'St Bonaventure'}, 1383: {'Team_Name': 'St Francis NY'}, 1384: {'Team_Name': 'St Francis PA'}, 1385: {'Team_Name': "St John's"}, 1386: {'Team_Name': "St Joseph's PA"}, 1387: {'Team_Name': 'St Louis'}, 1388: {'Team_Name': "St Mary's CA"}, 1389: {'Team_Name': "St Peter's"}, 1390: {'Team_Name': 'Stanford'}, 1391: {'Team_Name': 'Stetson'}, 1392: {'Team_Name': 'Stony Brook'}, 1393: {'Team_Name': 'Syracuse'}, 1394: {'Team_Name': 'TAM C. Christi'}, 1395: {'Team_Name': 'TCU'}, 1396: {'Team_Name': 'Temple'}, 1397: {'Team_Name': 'Tennessee'}, 1398: {'Team_Name': 'Tennessee St'}, 1399: {'Team_Name': 'Tennessee Tech'}, 1400: {'Team_Name': 'Texas'}, 1401: {'Team_Name': 'Texas A&M'}, 1402: {'Team_Name': 'Texas St'}, 1403: {'Team_Name': 'Texas Tech'}, 1404: {'Team_Name': 'TN Martin'}, 1405: {'Team_Name': 'Toledo'}, 1406: {'Team_Name': 'Towson'}, 1407: {'Team_Name': 'Troy'}, 1408: {'Team_Name': 'Tulane'}, 1409: {'Team_Name': 'Tulsa'}, 1410: {'Team_Name': 'UTRGV'}, 1411: {'Team_Name': 'TX Southern'}, 1412: {'Team_Name': 'UAB'}, 1413: {'Team_Name': 'UC Davis'}, 1414: {'Team_Name': 'UC Irvine'}, 1415: {'Team_Name': 'UC Riverside'}, 1416: {'Team_Name': 'UCF'}, 1417: {'Team_Name': 'UCLA'}, 1418: {'Team_Name': 'ULL'}, 1419: {'Team_Name': 'ULM'}, 1420: {'Team_Name': 'UMBC'}, 1421: {'Team_Name': 'UNC Asheville'}, 1422: {'Team_Name': 'UNC Greensboro'}, 1423: {'Team_Name': 'UNC Wilmington'}, 1424: {'Team_Name': 'UNLV'}, 1425: {'Team_Name': 'USC'}, 1426: {'Team_Name': 'UT Arlington'}, 1427: {'Team_Name': 'UT San Antonio'}, 1428: {'Team_Name': 'Utah'}, 1429: {'Team_Name': 'Utah St'}, 1430: {'Team_Name': 'Utah Valley'}, 1431: {'Team_Name': 'UTEP'}, 1432: {'Team_Name': 'Utica'}, 1433: {'Team_Name': 'VA Commonwealth'}, 1434: {'Team_Name': 'Valparaiso'}, 1435: {'Team_Name': 'Vanderbilt'}, 1436: {'Team_Name': 'Vermont'}, 1437: {'Team_Name': 'Villanova'}, 1438: {'Team_Name': 'Virginia'}, 1439: {'Team_Name': 'Virginia Tech'}, 1440: {'Team_Name': 'VMI'}, 1441: {'Team_Name': 'W Carolina'}, 1442: {'Team_Name': 'W Illinois'}, 1443: {'Team_Name': 'WKU'}, 1444: {'Team_Name': 'W Michigan'}, 1445: {'Team_Name': 'W Salem St'}, 1446: {'Team_Name': 'W Texas A&M'}, 1447: {'Team_Name': 'Wagner'}, 1448: {'Team_Name': 'Wake Forest'}, 1449: {'Team_Name': 'Washington'}, 1450: {'Team_Name': 'Washington St'}, 1451: {'Team_Name': 'Weber St'}, 1452: {'Team_Name': 'West Virginia'}, 1453: {'Team_Name': 'WI Green Bay'}, 1454: {'Team_Name': 'WI Milwaukee'}, 1455: {'Team_Name': 'Wichita St'}, 1456: {'Team_Name': 'William & Mary'}, 1457: {'Team_Name': 'Winthrop'}, 1458: {'Team_Name': 'Wisconsin'}, 1459: {'Team_Name': 'Wofford'}, 1460: {'Team_Name': 'Wright St'}, 1461: {'Team_Name': 'Wyoming'}, 1462: {'Team_Name': 'Xavier'}, 1463: {'Team_Name': 'Yale'}, 1464: {'Team_Name': 'Youngstown St'}}

def processResults(df, features, output_path, filename):
    TeamObjects = {TeamsDict['Team_Id'][k] : {'Team_Name' : TeamsDict['Team_Name'][k]} for k in TeamsDict['Team_Id']}
    for season in range(2003,2016):
        for k in TeamObjects:
            for f in features:
                TeamObjects[k][f] = 0
            TeamObjects[k]['GameCount'] = 0

        for index, game in df[df.Season == season].iterrows():
            d = game.to_dict()
            Wteam = d['Wteam']
            Lteam = d['Lteam']

            for f in features:
                if f.startswith('W'):
                    TeamObjects[Wteam][f] += d[f.replace('Avg', '')]
                if f.startswith('L'):
                    TeamObjects[Lteam][f] += d[f.replace('Avg', '')]

            TeamObjects[Wteam]['GameCount'] += 1
            TeamObjects[Lteam]['GameCount'] += 1

        for k in TeamObjects:
            for f in features:
                if TeamObjects[k]['GameCount'] > 0:
                    TeamObjects[k][f] /= TeamObjects[k]['GameCount']

        TeamStats = pandas.DataFrame.from_dict(TeamObjects, orient='index')
        mkdir_p(output_path)
        TeamStats.to_csv(output_path + filename + str(season) + '.csv')
        print('Wrote out ' + output_path + filename + str(season) + '.csv')

def run():
    compact_features = ['WscoreAvg', 'LscoreAvg']
    detailed_features = ['WscoreAvg', 'WfgmAvg', 'WfgaAvg', 'Wfgm3Avg', 'Wfga3Avg', 'WftmAvg', 'WftaAvg', 'WorAvg', 'WdrAvg', 'WastAvg', 'WtoAvg', 'WstlAvg', 'WblkAvg', 'WpfAvg',
                    'LscoreAvg', 'LfgmAvg', 'LfgaAvg', 'Lfgm3Avg', 'Lfga3Avg', 'LftmAvg', 'LftaAvg', 'LorAvg', 'LdrAvg', 'LastAvg', 'LtoAvg', 'LstlAvg', 'LblkAvg', 'LpfAvg']

    output_path = processeddata + 'RegularSeasonTeamStats/'
    filename = 'RegularSeasonCompactTeamStats'
    df = pandas.read_csv(datapath + 'RegularSeasonCompactResults.csv')
    processResults(df, compact_features, output_path, filename)
    filename = 'RegularSeasonDetailedTeamStats'
    df = pandas.read_csv(datapath + 'RegularSeasonDetailedResults.csv')
    processResults(df, detailed_features, output_path, filename)

    output_path = processeddata + 'TourneyTeamStats/'
    filename = 'TourneyCompactTeamStats'
    df = pandas.read_csv(datapath + 'TourneyCompactResults.csv')
    processResults(df, compact_features, output_path, filename)
    filename = 'TourneyDetailedTeamStats'
    df = pandas.read_csv(datapath + 'TourneyDetailedResults.csv')
    processResults(df, detailed_features, output_path, filename)
